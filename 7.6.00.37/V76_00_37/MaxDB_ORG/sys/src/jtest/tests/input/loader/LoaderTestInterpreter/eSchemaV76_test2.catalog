SQLMODE INTERNAL
//
USE SCHEMA "BIBLIOTHEK"
//
USE SCHEMA "BIBLIOTHEK"
//
CREATE TABLE "log-datei"
(
	"LNO"  Fixed (6,0),
	"LTITEL"  Char (50) ASCII,
	"LAUTOR"  Fixed (4,0),
	"LDATUM"  Date,
	"LUSER"  Char (32) ASCII
)
//
CREATE TABLE "COUNTRY"
(
	"COUNTRY_ID"  Fixed (3,0)  NOT NULL,
	"COUNTRY_NAME"  Char (30) ASCII  NOT NULL,
	PRIMARY KEY ("COUNTRY_ID")
)
//
GRANT INDEX,SELECT,INSERT,UPDATE,DELETE,REFERENCES ON FRITZ.COUNTRY TO MONA
//
GRANT INDEX,SELECT,INSERT,UPDATE,DELETE,REFERENCES ON FRITZ.COUNTRY TO PUCK
//
GRANT SELECT(COUNTRY_ID,COUNTRY_NAME) ON FRITZ.COUNTRY TO TANZA
//
GRANT SELECT(COUNTRY_ID,COUNTRY_NAME) ON FRITZ.COUNTRY TO TANZA WITH GRANT OPTION
//
CREATE TABLE "CITY"
(
	"ZIP"  Fixed (10,0)  NOT NULL,
	"COUNTRY_ID"  Fixed (3,0)  NOT NULL,
	"CITY_NAME"  Char (30) ASCII  NOT NULL,
	PRIMARY KEY ("ZIP", "COUNTRY_ID")
)
//
GRANT INDEX,SELECT,INSERT,UPDATE,DELETE,REFERENCES ON FRITZ.CITY TO MONA
//
GRANT INDEX,SELECT,INSERT,UPDATE,DELETE,REFERENCES ON FRITZ.CITY TO PUCK
//
CREATE TABLE "AUTOR"
(
	"AUTOR_ID"  Fixed (4,0)  NOT NULL,
	"AUTOR_VORNAME"  Char (30) ASCII,
	"AUTOR_NAME"  Char (30) ASCII  NOT NULL,
	"AUTOR_COUNTRY"  Fixed (3,0)  DEFAULT    0,
	"AUTOR_INFO"  Long ASCII,
	PRIMARY KEY ("AUTOR_ID")
)
//
CREATE TABLE "VERLAG"
(
	"VERLAG_ID"  Fixed (3,0)  NOT NULL,
	"VERLAG_NAME"  Char (30) ASCII  NOT NULL,
	"VERLAG_ADRESSE"  Char (30) ASCII,
	"VERLAG_ZIP"  Fixed (10,0),
	"VERLAG_COUNTRY"  Fixed (3,0),
	PRIMARY KEY ("VERLAG_ID")
)
//
CREATE TABLE "BUCH"
(
	"BUCH_ID"  Fixed (6,0)  NOT NULL,
	"BUCH_TITEL"  Char (50) ASCII  NOT NULL,
	"BUCH_AUTOR"  Fixed (4,0)  NOT NULL,
	"BUCH_TYP"  Char (30) ASCII,
	"BUCH_VERLAG"  Fixed (3,0)  DEFAULT    0,
	"BUCH_EDITION"  Char (30) ASCII,
	"BUCH_BESCHREIBUNG"  Long ASCII,
	PRIMARY KEY ("BUCH_ID"),
 CONSTRAINT "C_BUCH_1" CHECK BUCH_TYP IN ('roman','gedichte','theater','kunst','historisch','tagebuch','biografie','medizin','architektur','informatik','fremdsprachen','andere')
)
//
CREATE TRIGGER BUCH_DELETE_TRIGGER FOR BIBLIOTHEK.BUCH AFTER DELETE EXECUTE (          INSERT INTO BIBLIOTHEK."log-datei" SET LNO = :OLD.BUCH_ID, LTITEL = :OLD.BUCH_TITEL, LAUTOR = :OLD.BUCH_AUTOR, LUSER = USER, LDATUM = DATE;)  
//
USE SCHEMA "BIBLIOTHEK"
//
CREATE  INDEX "BUCH_AUTOR_INDEX" ON "AUTOR" ("AUTOR_NAME"  ASC,"AUTOR_VORNAME"  ASC )
//
ALTER INDEX "BUCH_AUTOR_INDEX" ON "AUTOR" ENABLE 
//
CREATE  INDEX "BUCH_TITEL_INDEX" ON "BUCH" ("BUCH_TITEL"  ASC )
//
ALTER INDEX "BUCH_TITEL_INDEX" ON "BUCH" ENABLE 
//
USE SCHEMA "BIBLIOTHEK"
//
ALTER TABLE "CITY" FOREIGN KEY "F_CITY" ("COUNTRY_ID") REFERENCES "COUNTRY" ("COUNTRY_ID") ON DELETE  CASCADE
//
ALTER TABLE "AUTOR" FOREIGN KEY "F_AUTOR" ("AUTOR_COUNTRY") REFERENCES "COUNTRY" ("COUNTRY_ID") ON DELETE  SET DEFAULT
//
ALTER TABLE "VERLAG" FOREIGN KEY "F_VERLAG_1" ("VERLAG_ZIP","VERLAG_COUNTRY") REFERENCES "CITY" ("ZIP","COUNTRY_ID") ON DELETE  CASCADE
//
ALTER TABLE "BUCH" FOREIGN KEY "F_BUCH_1" ("BUCH_AUTOR") REFERENCES "AUTOR" ("AUTOR_ID") ON DELETE  CASCADE
//
ALTER TABLE "BUCH" FOREIGN KEY "F_BUCH_2" ("BUCH_VERLAG") REFERENCES "VERLAG" ("VERLAG_ID") ON DELETE  SET DEFAULT
//
USE SCHEMA "BIBLIOTHEK"
//
CREATE VIEW BIBLIOTHEK.MY_BOOKS (BUCHINDEX, TITEL, VORNAME_AUTOR, NAME_AUTOR, VERLAG, VERLAG_STADT, VERLAG_LAND) AS SELECT BUCH.BUCH_ID, BUCH.BUCH_TITEL, AUTOR.AUTOR_VORNAME, AUTOR.AUTOR_NAME, VERLAG.VERLAG_NAME, CITY.CITY_NAME, COUNTRY.COUNTRY_NAMEFROM BIBLIOTHEK.BUCH, BIBLIOTHEK.AUTOR, BIBLIOTHEK.VERLAG, BIBLIOTHEK.CITY, BIBLIOTHEK.COUNTRYWHERE BUCH.BUCH_AUTOR=AUTOR.AUTOR_ID AND BUCH.BUCH_VERLAG=VERLAG.VERLAG_ID AND VERLAG.VERLAG_ZIP=CITY.ZIP AND VERLAG.VERLAG_COUNTRY = CITY.COUNTRY_ID AND CITY.COUNTRY_ID=COUNTRY.COUNTRY_ID
//
USE SCHEMA "BIBLIOTHEK"
//

